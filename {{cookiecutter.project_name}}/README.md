# {{ cookiecutter.project_name }}

## Features

- FastAPI
- PostgreSQL with PGAdmin
- React with Typescript
- SQLAlchemy and Alembic for managing migrations
- ORM with Ormar
- Pre-commit hooks (black, autoflake, isort, flake8, prettier)
- Poetry for managing backend dependencies and virtual environments
- Github Actions
- Dependabot config
- Docker images

and more...

## Local deployment

Start a local deployment with `docker-compose`

```bash
docker-compose -f docker-compose.yml up -d

# run database migration
docker-compose exec backend alembic upgrade head

# create database used for testing
docker-compose exec postgres createdb {{cookiecutter.project_slug}}_test -U postgres
```

Now you can navigate to the following URLs:

- Backend OpenAPI docs: http://localhost/api/v1/docs/
- Frontend: http://localhost

## Local development

### Setting up pre-commit hooks

Keep your code clean by using the configured pre-commit hooks. From the root of
the project, run the following to install the hooks:

```bash
pre-commit install
```

Now, pre-configured linters will be run on each `git commit`. If the config is
too restrictive for you, you can tweak the linters using the various config
files in the repo, eg. `.darglint`, `.flake8` and `[tool.mypy]` section in
`pyproject.toml`. Consult the docs for the linter to see what you can tweak.

### Backend

This project is set up to run the server and client locally for development
purposes so commands, eg. `pytest` and `alembic`, can be run on the host
machine using the virtual environment rather than in a docker container.

Start the ancillary services with `docker-compose`:

```bash
# stop the deployment started above
docker-compose down

# start just the ancillary services
docker-compose up -d
```

This will start:

- `postgres`
- `pgadmin` accessible on http://localhost:5050

To start the FastAPI server, first ensure you have `poetry` installed,
instructions [here](https://python-poetry.org/docs/#installation), then run:

```bash
cd backend

# install the dependencies and create the virtual environment
poetry install

# activate the virtual environment
source .venv/bin/activate

# start the FastAPI server, accessible at localhost:8000
uvicorn app.main:app --port 8000 --reload
```

#### Tests

Tests are run with `pytest`. Ensure the virtual environment is activated and you
have set up the test database as described above, then from the `backend`
directory run:

```bash
pytest # can optionally provide the path to a test file
```

#### Migrations

After a new `ormar` model is added, migrations can be autogenerated and run
with:

```bash
# create the migration
alembic revision --autogenerate -m "added a new model"

# apply the migration
alembic upgrade head
```

#### Dependencies

Dependencies are managed with `poetry`. To add a new dependency, run:

```python
poetry add package-name
```

This will add it to the virtual environment and to `pyproject.toml` and
`poetry.lock` so it's also available in the backend docker container.

### Frontend

As with the backend, to speed up the development cycle this project prefers to
run the frontend application locally. To start the frontend server, run:

```bash
cd frontend

# install the dependencies
yarn install

# start the server, the application will be available on http://localhost:3000
yarn start
```

The frontend is created with `create-react-app` with `typescript` option.
Consult [the docs](https://reactjs.org/docs/create-a-new-react-app.html) to see
what you can and can't do.

## Testing a deployment

Before you merge changes into main/master branch to trigger a docker image
build, it's a good idea to run everything in a container locally to see it's
working as expected. To do so, run from the project root:

```bash
# build the images locally
docker-compose -f docker-compose.yml build

# start the appliction
docker-compose -f docker-compose.yml up
```

## Credits

Created with
[cookiecutter-fastapi-react-psql](https://github.com/dbatten5/cookiecutter-fastapi-react-psql).
